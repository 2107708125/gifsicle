PACKAGE		= gifsicle
VERSION		= @VERSION@

.SUFFIXES:
.SUFFIXES: .c .o

.c.o:
	$(CC) $(CPPFLAGS) $(CFLAGS) -c $<

SHELL		= /bin/sh
prefix		= @prefix@
exec_prefix	= @exec_prefix@
VPATH		= @srcdir@
srcdir		= @srcdir@
bindir		= @bindir@
mandir		= @mandir@/man$(manext)
# Number to put on the man page filename.
manext		= 1

CC		= @CC@ $(PROFILING)
CCLINKER	= @CC@ $(PROFILING)
CFLAGS		= @CFLAGS@
CPPFLAGS	= @DEFS@
X_CPPFLAGS	= @X_CFLAGS@
PROFILING	= 
LDFLAGS		= @LDFLAGS@
X11LIB		= @X_LIBS@ @X_PRE_LIBS@ -lX11 @X_EXTRA_LIBS@

INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@

PROGRAMS	= @PROGRAMS@
GIFVIEWOBJS	= gifread.o giffunc.o gifunopt.o gifx.o gifview.o clp.o
GIFSICLEOBJS	= gifread.o giffunc.o gifwrite.o gifunopt.o clp.o \
		merge.o support.o quantize.o gifsicle.o

all: $(PROGRAMS)

gifsicle.o: gifsicle.c
	$(CC) -DVERSION=\"$(VERSION)\" $(CPPFLAGS) $(CFLAGS) -c $<
gifsicle: $(GIFSICLEOBJS)
	$(CCLINKER) $(CFLAGS) -o gifsicle $(GIFSICLEOBJS)

gifview: $(GIFVIEWOBJS)
	$(CCLINKER) $(CFLAGS) -o gifview $(GIFVIEWOBJS) $(X11LIB)
gifx.o: gifx.c
	$(CC) $(X_CPPFLAGS) $(CPPFLAGS) $(CFLAGS) -c $<
gifview.o: gifview.c
	$(CC) $(X_CPPFLAGS) $(CPPFLAGS) $(CFLAGS) -c $<

install: @INSTALLERS@
install-gifsicle: gifsicle
	$(INSTALL_PROGRAM) gifsicle $(bindir)/gifsicle
	$(INSTALL_DATA) gifsicle.man $(mandir)/gifsicle.$(manext)
install-gifview: gifview
	$(INSTALL_PROGRAM) gifview $(bindir)/gifview

clp.o: clp.c clp.h

giffunc.o: giffunc.c gif.h
gifread.o: gifread.c gif.h
gifwrite.o: gifwrite.c gif.h
gifunopt.o: gifunopt.c gif.h
gifx.o: gifx.c gifx.h gif.h

gifsicle.o: gifsicle.c gifsicle.h
merge.o: merge.c gifsicle.h
support.o: support.c gifsicle.h
quantize.o: quantize.c gifsicle.h

srclinks:
	for i in clp.c clp.h ; do \
	ln -s ../edlib/$$i $$i ; done
	for i in gif.h.in giffunc.c gifread.c gifwrite.c gifunopt.c \
	gifx.h gifx.c giftoc.c ; do \
	ln -s ../giflib/$$i $$i ; done

#####
# Cleaning and distribution

clean:
	rm -f $(PROGRAMS) *.o core *.core
mostlyclean: clean
distclean: mostlyclean
	rm -f Makefile config.status config.log config.cache
realclean: distclean

dist: mostlyclean
	rm -rf $(PACKAGE)-$(VERSION)
	mkdir $(PACKAGE)-$(VERSION) && chmod 0777 $(PACKAGE)-$(VERSION)
	cp INSTALL Makefile.in NEWS README configure configure.in install-sh \
	gif.h.in gifread.c gifwrite.c giffunc.c gifunopt.c \
	clp.c clp.h \
	gifsicle.h merge.c support.c quantize.c gifsicle.c gifsicle.min \
	gifx.h gifx.c gifview.c \
	$(PACKAGE)-$(VERSION)
	gtar czf $(PACKAGE)-$(VERSION).tar.gz $(PACKAGE)-$(VERSION)
	rm -r $(PACKAGE)-$(VERSION)
